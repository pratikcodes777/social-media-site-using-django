{% extends 'base.html' %}
{% load static %}


{% block content %}

<body>
  
    <!-- START main-wrapper -->
    <section class="d-flex">
  
        <!-- start of sidenav -->
        <aside>
            <div class="sidenav position-sticky d-flex flex-column justify-content-between">
                <a class="navbar-brand" href="{% url 'index' %}" class="logo">
                    <img src="{% static 'images/logo.png' %}" alt="">
                </a>
                <!-- end of navbar-brand -->
                <form class="d-flex" role="search" method="POST" action="{% url 'search' %}">
                    {% csrf_token %}
                    <input
                        class="form-control me-2"
                        type="search"
                        placeholder="Search"
                        name="search_query"
                        required
                        aria-label="Search"
                    >
                    <button class="btn btn-outline-success" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
                </form>

                {% include 'navbar.html' %}
                <!-- end of navbar -->

                <ul class="list-inline nml-2">
                    <li class="list-inline-item">
                        <a href="#!" class="text-white text-red-onHover pr-2">
                            <span class="fab fa-twitter"></span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#!" class="text-white text-red-onHover p-2">
                            <span class="fab fa-facebook-f"></span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#!" class="text-white text-red-onHover p-2">
                            <span class="fab fa-instagram"></span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#!" class="text-white text-red-onHover p-2">
                            <span class="fab fa-linkedin-in"></span>
                        </a>
                    </li>
                </ul>
                <!-- end of social-links -->
            </div>
        </aside>
        <!-- end of sidenav -->

        <div class="main-content" style="position: relative;">
            <div class="container pt-4 mt-5">
                <div class="row">
                    <!-- start of post list -->
                    <div class="col-lg-9">
                    {% include 'messages.html' %}

                        {% include 'post_list.html' with page_obj=page_obj %}
                    </div>
                    <!-- end of post list -->

                    <!-- <div class="col-lg-3 d-none d-lg-block">
                        {% if user.is_authenticated %}
                            <div class="widget text-center" sty>
                                <img class="author-thumb-sm rounded-circle d-block mx-auto" src="{{ profile.profile_img.url }}" alt="">
                                <h2 class="widget-title text-white d-inline-block mt-4">About Me</h2>
                                <p class="mt-4">
                                    Hello, {{ user.username }} here. My email goes by: 
                                    <strong>{{ user.email }}</strong>. <br> Here's a little about me: 
                                    "{{ profile.bio }}". <br>
                                    I currently reside in 
                                    {{ profile.location }}.
                                </p>
                                <a class="btn btn-primary" href="{% url 'profile' profile.user.username %}">My Profile</a>
                                <ul class="list-inline mt-3">
                                    <li class="list-inline-item">
                                        <a href="#!" class="text-white text-primary-onHover p-2">
                                            <span class="fab fa-twitter"></span>
                                        </a>
                                    </li>
                                    <li class="list-inline-item">
                                        <a href="#!" class="text-white text-primary-onHover p-2">
                                            <span class="fab fa-facebook-f"></span>
                                        </a>
                                    </li>
                                    <li class="list-inline-item">
                                        <a href="#!" class="text-white text-primary-onHover p-2">
                                            <span class="fab fa-instagram"></span>
                                        </a>
                                    </li>
                                    <li class="list-inline-item">
                                        <a href="#!" class="text-white text-primary-onHover p-2">
                                            <span class="fab fa-linkedin-in"></span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        {% endif %}
                    </div> -->
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const likeButtons = document.querySelectorAll('.like-btn');
            
                likeButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const postId = this.getAttribute('data-post-id');
            
                        fetch(`/post/like/${postId}/`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': '{{ csrf_token }}',
                            },
                            body: JSON.stringify({}),
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.liked) {
                                btn.classList.remove('btn-outline-primary');
                                btn.classList.add('btn-danger');
                                btn.innerHTML = '<span class="fas fa-heart"></span> Unlike';
                            } else {
                                btn.classList.remove('btn-danger');
                                btn.classList.add('btn-outline-primary');
                                btn.innerHTML = '<span class="fa-regular fa-heart"></span> Like';
                            }
                            document.getElementById('likes-count-' + postId).textContent = data.total_likes + ' Likes';
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    });
                });
            });
        </script>
    
    </section>
    <!-- END main-wrapper -->
</body>
{% endblock content %}
